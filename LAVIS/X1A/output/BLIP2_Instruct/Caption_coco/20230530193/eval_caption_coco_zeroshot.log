WARNING:__main__:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
| distributed init (rank 3, world 4): env://
| distributed init (rank 2, world 4): env://
| distributed init (rank 0, world 4): env://
| distributed init (rank 1, world 4): env://
2023-05-30 19:32:42,758 [INFO] 
=====  Running Parameters    =====
2023-05-30 19:32:42,759 [INFO] {
    "batch_size_eval": 16,
    "batch_size_train": 32,
    "device": "cuda",
    "dist_backend": "nccl",
    "dist_url": "env://",
    "distributed": true,
    "evaluate": true,
    "gpu": 0,
    "max_len": 30,
    "min_len": 8,
    "num_beams": 5,
    "num_workers": 4,
    "output_dir": "/root/Documents/DEMOS/InstructBLIP/output/BLIP2_Instruct/Caption_coco",
    "prompt": "a photo of ",
    "rank": 0,
    "seed": 42,
    "task": "captioning",
    "test_splits": [
        "test"
    ],
    "world_size": 4
}
2023-05-30 19:32:42,759 [INFO] 
======  Dataset Attributes  ======
2023-05-30 19:32:42,759 [INFO] 
======== coco_caption =======
2023-05-30 19:32:42,760 [INFO] {
    "build_info": {
        "annotations": {
            "test": {
                "md5": "3ff34b0ef2db02d01c37399f6a2a6cd1",
                "storage": "/root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_test.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_test.json"
            },
            "train": {
                "md5": "aa31ac474cf6250ebb81d18348a07ed8",
                "storage": "/root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_train.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_train.json"
            },
            "val": {
                "md5": "b273847456ef5580e33713b1f7de52a0",
                "storage": "/root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_val.json",
                "url": "https://storage.googleapis.com/sfr-vision-language-research/datasets/coco_karpathy_val.json"
            }
        },
        "images": {
            "storage": "/root/Documents/DATASETS/MS_COCO/images/"
        }
    },
    "data_type": "images",
    "dataset_card": "dataset_card/coco_caption.md",
    "text_processor": {
        "eval": {
            "name": "blip_caption"
        }
    },
    "vis_processor": {
        "eval": {
            "image_size": 224,
            "name": "blip_image_eval"
        }
    }
}
2023-05-30 19:32:42,760 [INFO] 
======  Model Attributes  ======
2023-05-30 19:32:42,760 [INFO] {
    "arch": "blip2_vicuna_instruct",
    "drop_path_rate": 0,
    "finetuned": "",
    "freeze_vit": true,
    "image_size": 224,
    "llm_model": "/root/Documents/MODELS/Vicuna/7B",
    "load_finetuned": false,
    "load_pretrained": true,
    "model_type": "vicuna7b",
    "num_query_token": 32,
    "pretrained": "https://storage.googleapis.com/sfr-vision-language-research/LAVIS/models/InstructBLIP/instruct_blip_vicuna7b_trimmed.pth",
    "prompt": "",
    "use_grad_checkpoint": false,
    "vit_precision": "fp16"
}
Using downloaded and verified file: /root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_train.json
Using downloaded and verified file: /root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_val.json
Using downloaded and verified file: /root/Documents/DATASETS/MS_COCO/annotations/coco_karpathy_test.json
2023-05-30 19:32:42,761 [INFO] Building datasets...
2023-05-30 19:33:04,742 [INFO] freeze vision encoder
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.06s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.16s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.73s/it]Loading checkpoint shards:  50%|█████     | 1/2 [00:09<00:09,  9.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.80s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.85s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  6.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.55s/it]
Loading checkpoint shards: 100%|██████████| 2/2 [00:14<00:00,  6.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:14<00:00,  7.22s/it]
2023-05-30 19:35:50,411 [INFO] load checkpoint from https://storage.googleapis.com/sfr-vision-language-research/LAVIS/models/InstructBLIP/instruct_blip_vicuna7b_trimmed.pth
2023-05-30 19:35:50,561 [INFO] dataset_ratios not specified, datasets will be concatenated (map-style datasets) or chained (webdataset.DataPipeline).
2023-05-30 19:35:50,561 [INFO] Loaded 566747 records for train split from the dataset.
2023-05-30 19:35:50,561 [INFO] Loaded 5000 records for val split from the dataset.
2023-05-30 19:35:50,561 [INFO] Loaded 5000 records for test split from the dataset.
2023-05-30 19:35:50,561 [INFO] Empty train splits.
2023-05-30 19:35:50,561 [INFO] Empty train splits.
2023-05-30 19:35:50,561 [INFO] Empty train splits.
Evaluation  [ 0/79]  eta: 0:06:07    time: 4.6529  data: 0.9030  max mem: 22699
Evaluation  [10/79]  eta: 0:02:07    time: 1.8442  data: 0.0833  max mem: 23539
Evaluation  [20/79]  eta: 0:01:42    time: 1.5928  data: 0.0013  max mem: 23658
Evaluation  [30/79]  eta: 0:01:22    time: 1.5983  data: 0.0012  max mem: 23658
Evaluation  [40/79]  eta: 0:01:04    time: 1.5555  data: 0.0012  max mem: 23658
Evaluation  [50/79]  eta: 0:00:47    time: 1.5243  data: 0.0012  max mem: 23658
Evaluation  [60/79]  eta: 0:00:30    time: 1.5291  data: 0.0012  max mem: 23658
Evaluation  [70/79]  eta: 0:00:14    time: 1.5551  data: 0.0012  max mem: 23658
Evaluation  [78/79]  eta: 0:00:01    time: 1.5461  data: 0.0084  max mem: 23658
Evaluation Total time: 0:02:05 (1.5945 s / it)
2023-05-30 19:38:05,801 [WARNING] rank 0 starts merging results.
result file saved to /root/Documents/DEMOS/InstructBLIP/output/BLIP2_Instruct/Caption_coco/20230530193/result/test_epochbest.json
Using downloaded and verified file: /root/Documents/CACHE/lavis/coco_gt/coco_karpathy_test_gt.json
loading annotations into memory...
Done (t=0.02s)
creating index...
index created!
Loading and preparing results...
DONE (t=0.01s)
creating index...
index created!
tokenization...
PTBTokenizer tokenized 307085 tokens at 1264289.72 tokens per second.
PTBTokenizer tokenized 67750 tokens at 480284.49 tokens per second.
setting up scorers...
computing Bleu score...
{'testlen': 62436, 'reflen': 57754, 'guess': [62436, 57436, 52436, 47436], 'correct': [46615, 27632, 14922, 7670]}
ratio: 1.0810679779755328
Bleu_1: 0.747
Bleu_2: 0.599
Bleu_3: 0.468
Bleu_4: 0.359
computing METEOR score...
METEOR: 0.321
computing Rouge score...
ROUGE_L: 0.585
computing CIDEr score...
CIDEr: 1.276
computing SPICE score...
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.nustaq.serialization.FSTClazzInfo (file:/data/root/anaconda3/envs/lavis/lib/python3.8/site-packages/pycocoevalcap/spice/lib/fst-2.47.jar) to field java.lang.String.value
WARNING: Please consider reporting this to the maintainers of org.nustaq.serialization.FSTClazzInfo
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
Parsing reference captions
Parsing test captions
Initiating Stanford parsing pipeline
[main] INFO edu.stanford.nlp.pipeline.StanfordCoreNLP - Adding annotator tokenize
[main] INFO edu.stanford.nlp.pipeline.TokenizerAnnotator - TokenizerAnnotator: No tokenizer type provided. Defaulting to PTBTokenizer.
[main] INFO edu.stanford.nlp.pipeline.StanfordCoreNLP - Adding annotator ssplit
[main] INFO edu.stanford.nlp.pipeline.StanfordCoreNLP - Adding annotator parse
[main] INFO edu.stanford.nlp.parser.common.ParserGrammar - Loading parser from serialized file edu/stanford/nlp/models/lexparser/englishPCFG.ser.gz ... 
done [0.4 sec].
[main] INFO edu.stanford.nlp.pipeline.StanfordCoreNLP - Adding annotator lemma
[main] INFO edu.stanford.nlp.pipeline.StanfordCoreNLP - Adding annotator ner
Loading classifier from edu/stanford/nlp/models/ner/english.all.3class.distsim.crf.ser.gz ... done [1.1 sec].
Loading classifier from edu/stanford/nlp/models/ner/english.muc.7class.distsim.crf.ser.gz ... done [0.5 sec].
Loading classifier from edu/stanford/nlp/models/ner/english.conll.4class.distsim.crf.ser.gz ... done [0.6 sec].
Threads( StanfordCoreNLP ) [12.367 seconds]
Warning: Nashorn engine is planned to be removed from a future JDK release
SPICE evaluation took: 22.93 s
SPICE: 0.263
Bleu_1: 0.747
Bleu_2: 0.599
Bleu_3: 0.468
Bleu_4: 0.359
METEOR: 0.321
ROUGE_L: 0.585
CIDEr: 1.276
SPICE: 0.263
